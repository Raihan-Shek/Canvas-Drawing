<!doctypehtml><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><meta content="Enhanced Canvas Drawing App with layers, shapes, images, rotation, text, eraser, undo/redo, hideable panel, foldable layers, and responsive design."name=description><title>Canvas Drawing App</title><style>:root{--primary-color:#000;--secondary-color:#663343;--background-color:#f4f4f9;--panel-bg-color:#fff;--border-color:#ddd;--shadow-color:rgba(0,0,0,.15);--active-layer-bg:var(--secondary-color);--handle-color:var(--primary-color)}body{background:linear-gradient(to bottom,var(--background-color),#e0e0e9);box-sizing:border-box;display:flex;flex-direction:row;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;gap:20px;margin:0;min-height:100vh;padding:20px}#toggle-controls{background:var(--primary-color);border:none;border-radius:4px;box-shadow:0 2px 5px var(--shadow-color);color:#fff;cursor:pointer;padding:8px 16px;position:fixed;right:10px;top:10px;transition:background .2s,transform .1s;z-index:10}#toggle-controls:hover{background:var(--secondary-color);transform:scale(1.05)}#canvas-container{background:#fff;border:2px solid #333;border-radius:12px;box-shadow:0 4px 12px var(--shadow-color);flex-grow:1;min-width:300px;position:relative}canvas{border-radius:10px;cursor:crosshair;display:block;height:100%;touch-action:none;width:100%}.controls{background:var(--panel-bg-color);border-radius:12px;box-shadow:0 4px 12px var(--shadow-color);display:flex;flex-direction:column;gap:15px;max-height:calc(100vh - 40px);min-width:300px;overflow-y:auto;padding:20px;transition:all .3s ease;width:300px}.controls.hidden{margin:0;min-width:0;opacity:0;padding:0;pointer-events:none;transform:translateX(100%);width:0}.controls h3{border-bottom:1px solid var(--border-color);color:#333;font-size:1.2em;margin:0 0 10px;padding-bottom:5px}.controls button,.controls input,.controls label,.controls select{margin-bottom:0}.controls button{background:var(--primary-color);border:none;border-radius:6px;color:#fff;cursor:pointer;padding:10px;transition:background .2s,transform .1s}.controls button:hover{background:var(--secondary-color);transform:scale(1.02)}.controls button.active{background:#135622;transform:scale(1.02)}.controls button:disabled{background:#ccc;cursor:not-allowed}.tool-group{display:grid;gap:8px;grid-template-columns:repeat(3,1fr)}details#layersAccordion{border:1px solid var(--border-color);border-radius:6px;padding:10px;user-select:none}summary{cursor:pointer;font-weight:700;outline:0}.layer-item{background:#e9ecef;border-radius:6px;cursor:pointer;display:flex;flex-direction:column;gap:5px;margin-bottom:5px;padding:10px;transition:background .2s,box-shadow .2s}.layer-item:hover{background:#d4d9de}.layer-info{align-items:center;display:flex;justify-content:space-between}.layer-buttons button{font-size:.9em;margin-left:5px;padding:4px 8px}.layer-item.active .layer-buttons button{color:var(--primary-color)}.layer-item.active .layer-buttons button:hover{background:#f0f0f0}.opacity-slider{cursor:grab;width:100%}#textModal{background:var(--panel-bg-color);border-radius:12px;box-shadow:0 8px 25px rgba(0,0,0,.4);display:none;left:50%;min-width:300px;padding:30px;position:fixed;top:50%;transform:translate(-50%,-50%);z-index:1000}#textModal h4{margin-top:0}#textModal input{border:1px solid var(--border-color);border-radius:6px;box-sizing:border-box;margin-bottom:20px;padding:10px;width:100%}#textModal button{margin-right:10px;min-width:80px}@media (max-width:1024px){body{flex-direction:column;gap:10px;padding:10px}#canvas-container{height:50vh;max-width:100%;min-height:300px;order:1;width:100%}.controls{max-height:none;max-height:40vh;min-width:100%;order:2;padding:15px;width:100%}#toggle-controls{bottom:10px;position:fixed;right:10px;top:auto;z-index:1100}.controls.hidden{gap:0;margin-bottom:-15px;max-height:0;padding:0 15px}#textModal{box-sizing:border-box;width:90%}}@media (max-width:480px){.tool-group{grid-template-columns:repeat(2,1fr)}}.layer-item.active{background:var(--active-layer-bg);box-shadow:0 2px 4px rgba(0,0,0,.2);color:#fff}.layer-item.active .layer-buttons button{background:#fff;color:var(--secondary-color)}#textModal button:focus,#textModal input:focus,.controls button:focus,.controls input:focus,.controls select:focus,.layer-item:focus{outline:3px solid #ffc107;outline-offset:2px}</style><button id=toggle-controls>Toggle Controls</button><div id=canvas-container><canvas height=800 id=myCanvas width=1200></canvas></div><div class=controls><h3>Tools</h3><div class=tool-group><button id=toolBrush class=active>Brush</button> <button id=toolEraser>Eraser</button> <button id=toolRect>Rectangle</button> <button id=toolCircle>Circle</button> <button id=toolLine>Line</button> <button id=toolText>Text</button></div><h3>Brush/Eraser</h3><label for=brushSize>Size: <span id=brushSizeValue>5</span></label> <input id=brushSize type=range value=5 max=50 min=1> <label>Color <input id=brushColor type=color value=#000000></label><h3>Shapes/Text</h3><label>Fill <input id=shapeFill type=checkbox></label> <label>Fill Color <input id=fillColor type=color value=#000000></label> <label for=shapeOpacity>Stroke Opacity: <span id=shapeOpacityValue>1</span></label> <input id=shapeOpacity type=range value=1 max=1 min=0 step=0.1><h3>Rotation</h3><label for=rotationRange>Angle: <span id=rotationValue>0°</span></label> <input id=rotationRange type=range value=0 max=180 min=-180 step=5> <button id=rotate90Clockwise>Rotate 90° ↻</button><h3>Images</h3><label>uploadImage <input id=uploadImage type=file accept=image/* multiple></label><h3>Layers</h3><details id=layersAccordion open><summary>Layers List (Top is Front)</summary><div id=layersPanel></div></details><div><button id=layerUp>Layer Up (Front)</button> <button id=layerDown>Layer Down (Back)</button></div><h3>History</h3><div><button id=undo disabled>Undo (Ctrl+Z)</button> <button id=redo disabled>Redo (Ctrl+Y)</button></div><h3>Download</h3><label for=format>Format:</label> <select id=format><option value=png>PNG (Lossless, Transparency)<option value=jpeg>JPEG (Lossy, No Transparency)<option value=svg>SVG (Vector - Shapes/Text/Line only)</select> <button id=download>Download Image</button><h3>Canvas</h3><button id=clearCanvas>Clear All</button></div><div id=textModal><h4>Enter Text</h4><input id=textInput maxlength=100 placeholder="Type your text here..."> <label>Font Size: <span id=textFontSizeValue>10</span></label> <input id=textFontSize type=range value=30 max=100 min=10><br><button id=confirmText>OK</button> <button id=cancelText>Cancel</button></div><script defer src="script.js?v=1"></script>
